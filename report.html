<!doctype html>
<html lang="zh-Hant-TW">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>eyeForm Report - Neurobit AI</title>

    <link rel="stylesheet" href="css/bootstrap.513.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/main.js"></script>

    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <py-env>
        - pandas
        - matplotlib
        - paths:
          - ./data_to_plot.pkl
    </py-env>
    <py-script output="plot" src="plot.py">
    </py-script>
  </head>
  <body class="p-3 m-0 border-0 bd-example">
    <table class="table">
      <thead>
        <tr>
          <th scope="col"><span id="site"></span>：<span id="medRecNo"></span></th>
          <th scope="col">右眼</th>
          <th scope="col">左眼</th>
        </tr>
      </thead>
      <tbody class="table-group-divider">
        <tr>
          <th scope="row">最佳矯正視力</th>
          <td><span id="od1"></span></td>
          <td><span id="os1"></span></td>
        </tr>
        <tr>
          <th scope="row">球面度數</th>
          <td><span id="od2"></span></td>
          <td><span id="os2"></span></td>
        </tr>
        <tr>
          <th scope="row">散光度數</th>
          <td><span id="od3"></span></td>
          <td><span id="os3"></span></td>
        </tr>
        <tr>
          <th scope="row">軸度</th>
          <td><span id="od4"></span></td>
          <td><span id="os4"></span></td>
        </tr>
        <tr>
          <th scope="row">軸長(mm)</th>
          <td><span id="od5"></span></td>
          <td><span id="os5"></span></td>
        </tr>
      </tbody>
      <tbody class="table-group-divider">
        <tr>
          <th scope="row">處置建議：<span id="treatment"></span></th>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <th scope="row">危險度分析</th>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3" align="center"><span id="age"></span> / <span id="sex"></span>生</td>
        </tr>
        <tr>
          <td colspan="3" align="center"><div id="plot"></div></td>
        </tr>
      </tbody>
      <tbody class="table-group-divider">
        <tr>
          <td colspan="3" align="center">© 2022 Neurobit Technologies</td>
        </tr>
      </tbody>
    </table>
    <script>
      document.getElementById('site').innerHTML = localStorage.getItem('site');
      document.getElementById('medRecNo').innerHTML = localStorage.getItem('medRecNo');
      document.getElementById('od1').innerHTML = parseFloat(localStorage.getItem('od1')).toFixed(1);
      document.getElementById('os1').innerHTML = parseFloat(localStorage.getItem('os1')).toFixed(1);
      document.getElementById('od2').innerHTML = parseFloat(localStorage.getItem('od2')).toFixed(2);
      document.getElementById('os2').innerHTML = parseFloat(localStorage.getItem('os2')).toFixed(2);
      document.getElementById('od3').innerHTML = parseFloat(localStorage.getItem('od3')).toFixed(2);
      document.getElementById('os3').innerHTML = parseFloat(localStorage.getItem('os3')).toFixed(2);
      document.getElementById('od4').innerHTML = parseFloat(localStorage.getItem('od4'));
      document.getElementById('os4').innerHTML = parseFloat(localStorage.getItem('os4'));
      document.getElementById('od5').innerHTML = parseFloat(localStorage.getItem('od5')).toFixed(2);
      document.getElementById('os5').innerHTML = parseFloat(localStorage.getItem('os5')).toFixed(2);
      document.getElementById('age').innerHTML = localStorage.getItem('age');
      document.getElementById('sex').innerHTML = localStorage.getItem('sex');
      var sex = localStorage.getItem('sex');
      var age = localStorage.getItem('age');
      var y1 = parseFloat(localStorage.getItem('od5'));
      var y2 = parseFloat(localStorage.getItem('os5'));
      var vision = Math.min(parseFloat(localStorage.getItem('od1')), parseFloat(localStorage.getItem('os1')));
      if (vision > 0.9) {
        document.getElementById('treatment').innerHTML = '無需處置';
      } else if (vision > 0.7) {
        document.getElementById('treatment').innerHTML = '點散瞳劑';
      } else if (vision > 0.5) {
        document.getElementById('treatment').innerHTML = '點散瞳劑、配戴一般眼鏡';
      } else {
        document.getElementById('treatment').innerHTML = '配戴一般眼鏡';
      }
    </script>
  </body>
</html>